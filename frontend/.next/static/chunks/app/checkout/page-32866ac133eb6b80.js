(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{7220:function(e,a,s){Promise.resolve().then(s.bind(s,4562))},4562:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return CheckoutPage}});var t=s(7437),r=s(2265),n=s(3198),i=s(1396),l=s.n(i),c=s(7270),d=s(6497),o=s(5436);let m={createOrder:async e=>{let a=await o.Z.post("/orders",e);return a.data},createRazorpayOrder:async e=>{let a=await o.Z.post("/payments/razorpay/order",{orderId:e});return a.data},verifyRazorpayPayment:async e=>{let a=await o.Z.post("/payments/razorpay/verify",e);return a.data}};var h=s(6422);function CheckoutPage(){let e=(0,n.I0)(),{items:a,total:s}=(0,n.v9)(e=>e.cart),[i,o]=(0,r.useState)(1),[x,p]=(0,r.useState)("online"),[u,y]=(0,r.useState)(!1),[j,f]=(0,r.useState)(null),[g,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=document.createElement("script");return e.src="https://checkout.razorpay.com/v1/checkout.js",e.onload=()=>N(!0),document.body.appendChild(e),()=>{document.body.removeChild(e)}},[]);let[b,v]=(0,r.useState)({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",zipCode:"",country:"India"}),[w,C]=(0,r.useState)({cardNumber:"",expiryDate:"",cvv:"",nameOnCard:""}),z=.08*s,P=s>50?0:9.99,k=s+z+P,handlePlaceOrder=async()=>{j?"online"===x?await initiatePayment():(e((0,d.LL)()),o(4)):await createOrder()},createOrder=async()=>{try{y(!0);let s={products:a.map(e=>({product:e.product.id,quantity:e.quantity,options:e.selectedOptions||{}})),shippingAddress:{street:"".concat(b.address,", ").concat(b.city,", ").concat(b.state),city:b.city,zip:b.zipCode,country:b.country},paymentMethod:x},t=await m.createOrder(s);f(t._id),"cod"===x?(e((0,d.LL)()),o(4)):await initiatePayment()}catch(e){console.error("Order creation failed:",e),alert("Failed to create order. Please try again.")}finally{y(!1)}},initiatePayment=async()=>{if(j&&g)try{y(!0);let a=await m.createRazorpayOrder(j),s={key:a.key,amount:a.order.amount,currency:a.order.currency,name:"Computer Shop",description:"Purchase from Computer Shop",order_id:a.order.id,handler:async a=>{try{await m.verifyRazorpayPayment({razorpay_order_id:a.razorpay_order_id,razorpay_payment_id:a.razorpay_payment_id,razorpay_signature:a.razorpay_signature}),e((0,d.LL)()),o(4)}catch(e){console.error("Payment verification failed:",e),alert("Payment verification failed. Please contact support.")}},prefill:{name:"".concat(b.firstName," ").concat(b.lastName),email:b.email,contact:b.phone},theme:{color:"#3B82F6"}},t=new window.Razorpay(s);t.open()}catch(e){console.error("Payment initiation failed:",e),alert("Failed to initiate payment. Please try again.")}finally{y(!1)}},I=[{id:1,name:"Shipping",completed:i>1},{id:2,name:"Payment Method",completed:i>2},{id:3,name:"Review",completed:i>3},{id:4,name:"Confirmation",completed:i>4}];return 0===a.length&&4!==i?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Your cart is empty"}),(0,t.jsx)(c.zx,{children:(0,t.jsx)(l(),{href:"/",children:"Continue Shopping"})})]})}):(0,t.jsx)("main",{className:"min-h-screen py-8",children:(0,t.jsxs)("div",{className:"container mx-auto px-4",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)("div",{className:"flex items-center justify-center",children:I.map((e,a)=>(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(e.completed?"bg-green-500 text-white":i===e.id?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"),children:e.completed?"âœ“":e.id}),(0,t.jsx)("span",{className:"ml-2 ".concat(i===e.id?"font-semibold":""),children:e.name}),a<I.length-1&&(0,t.jsx)("div",{className:"w-12 h-0.5 mx-4 ".concat(e.completed?"bg-green-500":"bg-gray-300")})]},e.id))})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,t.jsxs)("div",{className:"lg:col-span-2",children:[1===i&&(0,t.jsxs)("div",{className:"bg-white border rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Shipping Information"}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o(2)},className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)(c.II,{label:"First Name",value:b.firstName,onChange:e=>v({...b,firstName:e}),required:!0}),(0,t.jsx)(c.II,{label:"Last Name",value:b.lastName,onChange:e=>v({...b,lastName:e}),required:!0})]}),(0,t.jsx)(c.II,{type:"email",label:"Email",value:b.email,onChange:e=>v({...b,email:e}),required:!0}),(0,t.jsx)(c.II,{type:"tel",label:"Phone",value:b.phone,onChange:e=>v({...b,phone:e}),required:!0}),(0,t.jsx)(c.II,{label:"Address",value:b.address,onChange:e=>v({...b,address:e}),required:!0}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsx)(c.II,{label:"City",value:b.city,onChange:e=>v({...b,city:e}),required:!0}),(0,t.jsx)(c.II,{label:"State",value:b.state,onChange:e=>v({...b,state:e}),required:!0}),(0,t.jsx)(c.II,{label:"ZIP Code",value:b.zipCode,onChange:e=>v({...b,zipCode:e}),required:!0})]}),(0,t.jsx)(c.zx,{type:"submit",size:"lg",className:"w-full",children:"Continue to Payment"})]})]}),2===i&&(0,t.jsxs)("div",{className:"bg-white border rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Payment Method"}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),o(3)},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{id:"online",name:"paymentMethod",type:"radio",value:"online",checked:"online"===x,onChange:e=>p(e.target.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),(0,t.jsx)("label",{htmlFor:"online",className:"ml-3 block text-sm font-medium text-gray-700",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{children:"Online Payment (Razorpay)"}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"Pay securely with credit/debit card, UPI, net banking"})]})})]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("input",{id:"cod",name:"paymentMethod",type:"radio",value:"cod",checked:"cod"===x,onChange:e=>p(e.target.value),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300"}),(0,t.jsx)("label",{htmlFor:"cod",className:"ml-3 block text-sm font-medium text-gray-700",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{children:"Cash on Delivery (COD)"}),(0,t.jsx)("span",{className:"ml-2 text-xs text-gray-500",children:"Pay when you receive your order"})]})})]})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(c.zx,{type:"button",variant:"secondary",onClick:()=>o(1),className:"flex-1",children:"Back"}),(0,t.jsx)(c.zx,{type:"submit",size:"lg",className:"flex-1",children:"Review Order"})]})]})]}),3===i&&(0,t.jsxs)("div",{className:"bg-white border rounded-lg p-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-6",children:"Review Your Order"}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Items"}),(0,t.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:e.product.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Quantity: ",e.quantity]})]}),(0,t.jsx)("p",{className:"font-medium",children:(0,h.T)(e.product.price*e.quantity)})]},e.product.id))})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Shipping Address"}),(0,t.jsxs)("p",{children:[b.firstName," ",b.lastName]}),(0,t.jsx)("p",{children:b.address}),(0,t.jsxs)("p",{children:[b.city,", ",b.state," ",b.zipCode]}),(0,t.jsx)("p",{children:b.email}),(0,t.jsx)("p",{children:b.phone})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Payment Method"}),(0,t.jsx)("p",{className:"capitalize",children:"online"===x?"Online Payment (Razorpay)":"Cash on Delivery"})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(c.zx,{type:"button",variant:"secondary",onClick:()=>o(2),className:"flex-1",children:"Back"}),(0,t.jsx)(c.zx,{onClick:handlePlaceOrder,size:"lg",className:"flex-1",disabled:u,children:u?"Processing...":"online"===x?"Pay Now":"Place Order"})]})]}),4===i&&(0,t.jsxs)("div",{className:"bg-white border rounded-lg p-6 text-center",children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)("svg",{className:"mx-auto h-16 w-16 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,t.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Order Confirmed!"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Thank you for your order. You'll receive a confirmation email shortly."}),(0,t.jsx)(c.zx,{size:"lg",children:(0,t.jsx)(l(),{href:"/",children:"Continue Shopping"})})]})]}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)("div",{className:"bg-white border rounded-lg p-6 sticky top-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Order Summary"}),(0,t.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Subtotal:"}),(0,t.jsx)("span",{children:(0,h.T)(s)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Shipping:"}),(0,t.jsx)("span",{children:0===P?"Free":(0,h.T)(P)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Tax:"}),(0,t.jsx)("span",{children:(0,h.T)(z)})]})]}),(0,t.jsx)("hr",{className:"my-4"}),(0,t.jsxs)("div",{className:"flex justify-between text-xl font-semibold",children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsx)("span",{children:(0,h.T)(k)})]})]})})]})]})})}},5436:function(e,a,s){"use strict";var t=s(4829);let r=t.Z.create({baseURL:"http://localhost:5000/api",headers:{"Content-Type":"application/json"}});r.interceptors.request.use(e=>{let a=localStorage.getItem("token");return a&&(e.headers.Authorization="Bearer ".concat(a)),e}),r.interceptors.response.use(e=>e,e=>{var a;return(null===(a=e.response)||void 0===a?void 0:a.status)===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(e)}),a.Z=r}},function(e){e.O(0,[4,197,829,270,971,472,744],function(){return e(e.s=7220)}),_N_E=e.O()}]);